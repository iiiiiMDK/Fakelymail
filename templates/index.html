<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>fakelymail - Temporary Email</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* â† ÙƒÙ„ CSS Ø§Ù„Ù„ÙŠ Ø³ÙˆÙŠÙ†Ø§Ù‡ØŒ Ø´Ø§Ù…Ù„Ù‡ Ù„Ù„Ø¯Ø§ÙƒÙ† ÙˆØ§Ù„Ù†Ù‡Ø§Ø±ÙŠ ÙˆØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬ÙˆØ§Ù„ ÙˆØ´ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŒ Ù…Ø«Ù„ Ù…Ø§ Ø£Ø±Ø³Ù„ØªÙ‡ Ø³Ø§Ø¨Ù‚Ù‹Ø§ */
  </style>
</head>
<body>

  <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
  <div class="logo-container">
    <a href="/">
      <img src="/static/logo.png" alt="Fakelymail Logo" class="logo">
    </a>
  </div>

  <!-- Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ -->
  <button id="toggle-mode" onclick="toggleMode()">ğŸŒ™</button>

  <div class="container">
    <h1>fakelymail</h1>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
    <div class="buttons-group">
      <button title="ğŸ“‹ Copy All" onclick="copyAllMessages()">ğŸ“‹</button>
      <button title="ğŸ“¥ Download" onclick="downloadMessages()">ğŸ“¥</button>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„ÙˆÙ‡Ù…ÙŠ -->
    <p style="text-align:center;">Your temporary email address:</p>
    <div class="email-box">
      <div class="email-address" id="email">{{ email }}</div>
      <div>
        <button title="ğŸ“‹ Copy Email" onclick="copyEmail()">ğŸ“‹</button>
        <button title="ğŸ”„ Change Email" onclick="changeEmail()">ğŸ”„</button>
      </div>
    </div>

    <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆÙ‚Øª -->
    <div id="timer" class="timer-box">â³ {{ timer }}s</div>

    <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
    <h2>Inbox</h2>
    <div id="messages">Loading...</div>

    <!-- Ø¥Ø´Ø¹Ø§Ø± ØµØºÙŠØ± -->
    <div id="toast" class="toast"></div>

    <!-- Ø±ÙˆØ§Ø¨Ø· -->
    <div style="text-align: center; margin-top: 2rem; font-size: 0.9rem; color: gray;">
      <a href="/privacy" class="footer-link" style="color: #0984e3; text-decoration: none; margin-right: 15px;">Privacy Policy</a>
      <a href="/contact" class="footer-link" style="color: #0984e3; text-decoration: none;">Contact</a>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.innerText = msg;
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 2000);
    }

    function copyEmail() {
      navigator.clipboard.writeText(document.getElementById("email").innerText);
      showToast("Email copied!");
    }

    function changeEmail() {
      fetch('/change').then(() => location.reload());
    }

    function copyAllMessages() {
      fetch('/messages')
        .then(res => res.json())
        .then(data => {
          if (data.length === 0) return showToast("No messages to copy.");
          let text = "";
          data.forEach(msg => {
            text += `From: ${msg.from}\nSubject: ${msg.subject}\n${msg.body}\n---\n`;
          });
          navigator.clipboard.writeText(text);
          showToast("All messages copied!");
        });
    }

    function downloadMessages() {
      fetch('/messages')
        .then(res => res.json())
        .then(data => {
          if (data.length === 0) return showToast("No messages to download.");
          let text = "";
          data.forEach(msg => {
            text += `From: ${msg.from}\nSubject: ${msg.subject}\n${msg.body}\n---\n`;
          });
          const blob = new Blob([text], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "messages.txt";
          a.click();
          URL.revokeObjectURL(url);
        });
    }

    let timeLeft = {{ timer }};
    setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById("timer").innerText = `â³ ${minutes}m ${seconds}s`;
      }
    }, 1000);

    function loadMessages() {
      fetch('/messages')
        .then(res => res.json())
        .then(data => {
          const box = document.getElementById("messages");
          if (data.length === 0) {
            box.innerHTML = "<p style='color:gray;'>No messages yet.</p>";
            return;
          }
          box.innerHTML = "";
          data.forEach(msg => {
            const div = document.createElement("div");
            div.className = "message";
            div.innerHTML = `
              <div class="msg-header">From: ${msg.from}</div>
              <div><strong>Subject:</strong> ${msg.subject}</div>
              <div>${msg.body}</div>
              <small>${msg.timestamp}</small>
            `;
            box.appendChild(div);
          });
        });
    }

    setInterval(loadMessages, 5000);
    loadMessages();

    function toggleMode() {
      const body = document.body;
      body.classList.toggle('dark-mode');
      const isDark = body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);
      document.getElementById("toggle-mode").innerText = isDark ? "â˜€ï¸" : "ğŸŒ™";
    }

    window.onload = () => {
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        document.body.classList.add('dark-mode');
        document.getElementById("toggle-mode").innerText = "â˜€ï¸";
      }
    }
  </script>

</body>
</html>