<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>fakelymail - Temporary Email</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f5f6fa; margin: 0; padding: 0; }
    .container { max-width: 700px; margin: auto; padding: 2rem; }
    h1 { text-align: center; color: #2f3640; }
    .email-box { background: #fff; border: 1px solid #dcdde1; padding: 1rem; border-radius: 10px; margin: 1rem 0; display: flex; justify-content: space-between; align-items: center; }
    .email-address { font-size: 1.2rem; word-break: break-word; }
    button { background: #0984e3; color: white; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 1rem; margin-left: 0.5rem; }
    #timer { text-align: center; margin: 1rem 0; font-weight: bold; color: #636e72; }
    .message { background: #dfe6e9; padding: 10px; border-radius: 6px; margin-bottom: 10px; }
    .msg-header { font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>fakelymail</h1>
    <p style="text-align:center;">Your temporary email address:</p>
    <div class="email-box">
      <div class="email-address" id="email">{{ email }}</div>
      <div>
        <button onclick="copyEmail()">Copy</button>
        <button onclick="changeEmail()">Change</button>
      </div>
    </div>
    <div id="timer">Expires in: {{ timer }} seconds</div>

    <h2>Inbox</h2>
    <div id="messages">Loading...</div>
  </div>

  <script>
    function copyEmail() {
      navigator.clipboard.writeText(document.getElementById("email").innerText);
      alert("Copied!");
    }

    function changeEmail() {
      fetch('/change').then(() => location.reload());
    }

    let timeLeft = parseInt(document.getElementById("timer").innerText.replace(/\\D/g, ''));
    setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        document.getElementById("timer").innerText = "Expires in: " + timeLeft + " seconds";
      }
    }, 1000);

    function loadMessages() {
      fetch('/messages')
        .then(res => res.json())
        .then(data => {
          const box = document.getElementById("messages");
          if (data.length === 0) {
            box.innerHTML = "<p style='color:gray;'>No messages yet.</p>";
            return;
          }
          box.innerHTML = "";
          data.forEach(msg => {
            const div = document.createElement("div");
            div.className = "message";
            div.innerHTML = `
              <div class="msg-header">From: ${msg.from}</div>
              <div><strong>Subject:</strong> ${msg.subject}</div>
              <div>${msg.body}</div>
              <small>${msg.timestamp}</small>
            `;
            box.appendChild(div);
          });
        });
    }

    setInterval(loadMessages, 5000);
    loadMessages();
  </script>
</body>
</html>