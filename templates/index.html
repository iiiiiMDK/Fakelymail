<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>fakelymail - Temporary Email</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ← كل CSS اللي سويناه، شامله للداكن والنهاري وتصميم الجوال وشكل الرسائل، مثل ما أرسلته سابقًا */
  </style>
</head>
<body>

  <!-- شعار الموقع -->
  <div class="logo-container">
    <a href="/">
      <img src="/static/logo.png" alt="Fakelymail Logo" class="logo">
    </a>
  </div>

  <!-- زر الوضع الليلي -->
  <button id="toggle-mode" onclick="toggleMode()">🌙</button>

  <div class="container">
    <h1>fakelymail</h1>

    <!-- أزرار الأدوات -->
    <div class="buttons-group">
      <button title="📋 Copy All" onclick="copyAllMessages()">📋</button>
      <button title="📥 Download" onclick="downloadMessages()">📥</button>
    </div>

    <!-- عرض الإيميل الوهمي -->
    <p style="text-align:center;">Your temporary email address:</p>
    <div class="email-box">
      <div class="email-address" id="email">{{ email }}</div>
      <div>
        <button title="📋 Copy Email" onclick="copyEmail()">📋</button>
        <button title="🔄 Change Email" onclick="changeEmail()">🔄</button>
      </div>
    </div>

    <!-- عداد الوقت -->
    <div id="timer" class="timer-box">⏳ {{ timer }}s</div>

    <!-- الرسائل -->
    <h2>Inbox</h2>
    <div id="messages">Loading...</div>

    <!-- إشعار صغير -->
    <div id="toast" class="toast"></div>

    <!-- روابط -->
    <div style="text-align: center; margin-top: 2rem; font-size: 0.9rem; color: gray;">
      <a href="/privacy" class="footer-link" style="color: #0984e3; text-decoration: none; margin-right: 15px;">Privacy Policy</a>
      <a href="/contact" class="footer-link" style="color: #0984e3; text-decoration: none;">Contact</a>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.innerText = msg;
      toast.style.display = "block";
      setTimeout(() => { toast.style.display = "none"; }, 2000);
    }

    function copyEmail() {
      navigator.clipboard.writeText(document.getElementById("email").innerText);
      showToast("Email copied!");
    }

    function changeEmail() {
      fetch('/change').then(() => location.reload());
    }

    function copyAllMessages() {
      fetch('/messages')
        .then(res => res.json())
        .then(data => {
          if (data.length === 0) return showToast("No messages to copy.");
          let text = "";
          data.forEach(msg => {
            text += `From: ${msg.from}\nSubject: ${msg.subject}\n${msg.body}\n---\n`;
          });
          navigator.clipboard.writeText(text);
          showToast("All messages copied!");
        });
    }

    function downloadMessages() {
      fetch('/messages')
        .then(res => res.json())
        .then(data => {
          if (data.length === 0) return showToast("No messages to download.");
          let text = "";
          data.forEach(msg => {
            text += `From: ${msg.from}\nSubject: ${msg.subject}\n${msg.body}\n---\n`;
          });
          const blob = new Blob([text], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "messages.txt";
          a.click();
          URL.revokeObjectURL(url);
        });
    }

    let timeLeft = {{ timer }};
    setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById("timer").innerText = `⏳ ${minutes}m ${seconds}s`;
      }
    }, 1000);

    function loadMessages() {
      fetch('/messages')
        .then(res => res.json())
        .then(data => {
          const box = document.getElementById("messages");
          if (data.length === 0) {
            box.innerHTML = "<p style='color:gray;'>No messages yet.</p>";
            return;
          }
          box.innerHTML = "";
          data.forEach(msg => {
            const div = document.createElement("div");
            div.className = "message";
            div.innerHTML = `
              <div class="msg-header">From: ${msg.from}</div>
              <div><strong>Subject:</strong> ${msg.subject}</div>
              <div>${msg.body}</div>
              <small>${msg.timestamp}</small>
            `;
            box.appendChild(div);
          });
        });
    }

    setInterval(loadMessages, 5000);
    loadMessages();

    function toggleMode() {
      const body = document.body;
      body.classList.toggle('dark-mode');
      const isDark = body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);
      document.getElementById("toggle-mode").innerText = isDark ? "☀️" : "🌙";
    }

    window.onload = () => {
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) {
        document.body.classList.add('dark-mode');
        document.getElementById("toggle-mode").innerText = "☀️";
      }
    }
  </script>

</body>
</html>